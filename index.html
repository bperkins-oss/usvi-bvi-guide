<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bill And Lara's USVI & BVI Highlights</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>
        html { height: 100%; }\n        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a5276 0%, #2e86ab 100%);
            min-height: 100%;
        }
        .header {
            background: linear-gradient(135deg, #0c2340 0%, #1a5276 100%);
            color: white;
            padding: 20px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }
        .container {
            display: flex;
            height: auto; min-height: 500px;
        }
        #map {
            flex: 1;
            min-height: 500px;
        }
        .sidebar {
            width: 380px;
            background: white;
            overflow-y: auto; -webkit-overflow-scrolling: touch;
            box-shadow: -5px 0 20px rgba(0,0,0,0.2);
        }
        .filter-section {
            padding: 15px;
            background: #f8f9fa;
            border-bottom: 2px solid #e9ecef;
            position: sticky;
            top: 0;
            z-index: 100;
        }
        .filter-section h3 {
            margin-bottom: 10px;
            color: #0c2340;
        }
        .filter-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        .filter-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.85em;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .filter-btn.active {
            transform: scale(1.05);
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }
        .filter-btn.beach { background: #ffeaa7; color: #b8860b; }
        .filter-btn.beach.active { background: #f1c40f; color: #fff; }
        .filter-btn.restaurant { background: #fab1a0; color: #c0392b; }
        .filter-btn.restaurant.active { background: #e74c3c; color: #fff; }
        .filter-btn.activity { background: #81ecec; color: #00838f; }
        .filter-btn.activity.active { background: #00bcd4; color: #fff; }
        .filter-btn.snorkel { background: #a29bfe; color: #5e35b1; }
        .filter-btn.snorkel.active { background: #7c4dff; color: #fff; }
        .filter-btn.bar { background: #fd79a8; color: #ad1457; }
        .filter-btn.bar.active { background: #e91e63; color: #fff; }
        .filter-btn.shopping { background: #dfe6e9; color: #2d3436; }
        .filter-btn.shopping.active { background: #636e72; color: #fff; }
        .filter-btn.favorite { background: #ff7675; color: #fff; border: 2px solid gold; }
        .filter-btn.favorite.active { background: #d63031; }

        .location-list {
            padding: 10px;
        }
        .island-section {
            margin-bottom: 20px;
        }
        .island-header {
            background: linear-gradient(135deg, #0c2340 0%, #1a5276 100%);
            color: white;
            padding: 12px 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .island-header:hover {
            background: linear-gradient(135deg, #1a5276 0%, #2e86ab 100%);
        }
        .location-card {
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            border-left: 4px solid #ccc;
        }
        .location-card:hover {
            transform: translateX(5px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        .location-card.beach { border-left-color: #f1c40f; }
        .location-card.restaurant { border-left-color: #e74c3c; }
        .location-card.activity { border-left-color: #00bcd4; }
        .location-card.snorkel { border-left-color: #7c4dff; }
        .location-card.bar { border-left-color: #e91e63; }
        .location-card.shopping { border-left-color: #636e72; }
        .location-card.favorite { border-left-color: gold; border-left-width: 6px; }

        .location-card h4 {
            color: #0c2340;
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .location-card .category-tag {
            font-size: 0.7em;
            padding: 2px 8px;
            border-radius: 10px;
            background: #e9ecef;
            color: #495057;
        }
        .location-card p {
            font-size: 0.85em;
            color: #666;
            line-height: 1.4;
        }
        .location-card a {
            color: #2e86ab;
            text-decoration: none;
            font-size: 0.8em;
        }
        .location-card a:hover {
            text-decoration: underline;
        }
        .star {
            color: gold;
        }

        /* Enhanced Popup styling with images */
        .leaflet-popup-content-wrapper {
            border-radius: 12px;
            padding: 0;
            overflow: visible;
        }
        .leaflet-popup-content {
            margin: 0;
            min-width: 320px;
            max-width: 350px;
        }
        .popup-images {
            display: flex;
            gap: 4px;
            background: #f0f0f0;
        }
        .popup-images img {
            width: 50%;
            height: 120px;
            object-fit: cover;
            cursor: pointer;
            transition: transform 0.3s ease;
        }
        .popup-images img:hover {
            transform: scale(1.05);
        }
        .popup-content {
            padding: 15px;
        }
        .popup-title {
            font-weight: bold;
            font-size: 1.15em;
            color: #0c2340;
            margin-bottom: 8px;
            border-bottom: 2px solid #2e86ab;
            padding-bottom: 5px;
        }
        .popup-category {
            display: inline-block;
            padding: 3px 10px;
            border-radius: 15px;
            font-size: 0.75em;
            margin-bottom: 8px;
        }
        .popup-description {
            font-size: 0.9em;
            color: #444;
            line-height: 1.5;
            margin-bottom: 10px;
        }
        .popup-island {
            font-size: 0.8em;
            color: #666;
            margin-bottom: 10px;
        }
        .popup-link {
            display: inline-block;
            background: #2e86ab;
            color: white;
            padding: 6px 14px;
            border-radius: 5px;
            text-decoration: none;
            font-size: 0.85em;
            transition: background 0.3s ease;
        }
        .popup-link:hover {
            background: #1a5276;
        }

        /* Image Modal */
        .image-modal {
            display: none;
            position: fixed;
            z-index: 10000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.9);
            justify-content: center;
            align-items: center;
        }
        .image-modal.active {
            display: flex;
        }
        .image-modal img {
            max-width: 90%;
            max-height: 90%;
            border-radius: 8px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.5);
        }
        .image-modal .close {
            position: absolute;
            top: 20px;
            right: 30px;
            color: white;
            font-size: 40px;
            cursor: pointer;
        }

        .legend {
            background: white;
            padding: 10px 15px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }
        .legend h4 {
            margin-bottom: 8px;
            color: #0c2340;
        }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            margin: 5px 0;
            font-size: 0.85em;
        }
        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 50%;
        }

        @media (max-width: 768px) {
            .container {
                flex-direction: column;
            }
            .sidebar {
                width: 100%;
                max-height: 50vh;
            }
            #map {
                min-height: 400px;
            }
            .leaflet-popup-content {
                min-width: 280px;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>USVI & BVI Highlights</h1>
        <p>Your Interactive Guide to the Virgin Islands - Click any marker for photos & details</p>
    </div>

    <div class="container">
        <div id="map"></div>
        <div class="sidebar">
            <div class="filter-section">
                <h3>Filter by Category</h3>
                <div class="filter-buttons">
                    <button class="filter-btn favorite active" data-category="favorite">My Favorites</button>
                    <button class="filter-btn beach active" data-category="beach">Beaches</button>
                    <button class="filter-btn restaurant active" data-category="restaurant">Restaurants</button>
                    <button class="filter-btn activity active" data-category="activity">Activities</button>
                    <button class="filter-btn snorkel active" data-category="snorkel">Snorkeling</button>
                    <button class="filter-btn bar active" data-category="bar">Bars</button>
                    <button class="filter-btn shopping active" data-category="shopping">Shopping</button>
                </div>
            </div>
            <div class="location-list" id="locationList"></div>
        </div>
    </div>

    <!-- Image Modal -->
    <div class="image-modal" id="imageModal">
        <span class="close" onclick="closeModal()">&times;</span>
        <img id="modalImage" src="" alt="Location Image">
    </div>

    <script>
        // Initialize map centered on Virgin Islands
        const map = L.map('map').setView([18.35, -64.85], 10);

        // Satellite imagery layer (Esri World Imagery)
        const satellite = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
            attribution: 'Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community'
        });

        // Street map layer (OpenStreetMap)
        const streets = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; OpenStreetMap contributors'
        });

        // Labels overlay for satellite view
        const labels = L.tileLayer('https://{s}.basemaps.cartocdn.com/light_only_labels/{z}/{x}/{y}{r}.png', {
            attribution: '&copy; OpenStreetMap contributors &copy; CARTO',
            subdomains: 'abcd',
            pane: 'shadowPane'
        });

        // Add satellite as default
        satellite.addTo(map);
        labels.addTo(map);

        // Layer control
        const baseMaps = {
            "Satellite": satellite,
            "Streets": streets
        };
        L.control.layers(baseMaps, null, { position: 'topright' }).addTo(map);

        // Custom icons
        const icons = {
            home: L.divIcon({
                className: 'custom-icon',
                html: '<div style="background:linear-gradient(135deg,#667eea,#764ba2);width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;border:4px solid #fff;box-shadow:0 3px 10px rgba(0,0,0,0.4);font-size:20px;">üè†</div>',
                iconSize: [40, 40],
                iconAnchor: [20, 20],
                popupAnchor: [0, -20]
            }),
            beach: L.divIcon({
                className: 'custom-icon',
                html: '<div style="background:#f1c40f;width:28px;height:28px;border-radius:50%;display:flex;align-items:center;justify-content:center;border:3px solid #fff;box-shadow:0 2px 5px rgba(0,0,0,0.3);font-size:14px;">üèñÔ∏è</div>',
                iconSize: [28, 28],
                iconAnchor: [14, 14]
            }),
            restaurant: L.divIcon({
                className: 'custom-icon',
                html: '<div style="background:#e74c3c;width:28px;height:28px;border-radius:50%;display:flex;align-items:center;justify-content:center;border:3px solid #fff;box-shadow:0 2px 5px rgba(0,0,0,0.3);font-size:14px;">üçΩÔ∏è</div>',
                iconSize: [28, 28],
                iconAnchor: [14, 14]
            }),
            activity: L.divIcon({
                className: 'custom-icon',
                html: '<div style="background:#00bcd4;width:28px;height:28px;border-radius:50%;display:flex;align-items:center;justify-content:center;border:3px solid #fff;box-shadow:0 2px 5px rgba(0,0,0,0.3);font-size:14px;">üéØ</div>',
                iconSize: [28, 28],
                iconAnchor: [14, 14]
            }),
            snorkel: L.divIcon({
                className: 'custom-icon',
                html: '<div style="background:#7c4dff;width:28px;height:28px;border-radius:50%;display:flex;align-items:center;justify-content:center;border:3px solid #fff;box-shadow:0 2px 5px rgba(0,0,0,0.3);font-size:14px;">ü§ø</div>',
                iconSize: [28, 28],
                iconAnchor: [14, 14]
            }),
            bar: L.divIcon({
                className: 'custom-icon',
                html: '<div style="background:#e91e63;width:28px;height:28px;border-radius:50%;display:flex;align-items:center;justify-content:center;border:3px solid #fff;box-shadow:0 2px 5px rgba(0,0,0,0.3);font-size:14px;">üçπ</div>',
                iconSize: [28, 28],
                iconAnchor: [14, 14]
            }),
            shopping: L.divIcon({
                className: 'custom-icon',
                html: '<div style="background:#636e72;width:28px;height:28px;border-radius:50%;display:flex;align-items:center;justify-content:center;border:3px solid #fff;box-shadow:0 2px 5px rgba(0,0,0,0.3);font-size:14px;">üõçÔ∏è</div>',
                iconSize: [28, 28],
                iconAnchor: [14, 14]
            }),
            favorite: L.divIcon({
                className: 'custom-icon',
                html: '<div style="background:#d63031;width:32px;height:32px;border-radius:50%;display:flex;align-items:center;justify-content:center;border:4px solid gold;box-shadow:0 2px 8px rgba(0,0,0,0.4);font-size:16px;">‚≠ê</div>',
                iconSize: [32, 32],
                iconAnchor: [16, 16]
            })
        };

        // Curated image collections for each location type and specific locations
        const imageLibrary = {
            "Home Base": [
                "home-pool.jpg",
                "home-interior.jpg"
            ],
            // Specific location images (Unsplash direct links)
            "Magens Bay": [
                "https://images.unsplash.com/photo-1590523741831-ab7e8b8f9c7f?w=400&h=300&fit=crop",
                "https://images.unsplash.com/photo-1544551763-46a013bb70d5?w=400&h=300&fit=crop"
            ],
            "Trunk Bay": [
                "https://images.unsplash.com/photo-1507525428034-b723cf961d3e?w=400&h=300&fit=crop",
                "https://images.unsplash.com/photo-1519046904884-53103b34b206?w=400&h=300&fit=crop"
            ],
            "Sapphire Beach": [
                "https://images.unsplash.com/photo-1506953823976-52e1fdc0149a?w=400&h=300&fit=crop",
                "https://images.unsplash.com/photo-1473116763249-2faaef81ccda?w=400&h=300&fit=crop"
            ],
            "The Baths": [
                "https://images.unsplash.com/photo-1559128010-7c1ad6e1b6a5?w=400&h=300&fit=crop",
                "https://images.unsplash.com/photo-1518837695005-2083093ee35b?w=400&h=300&fit=crop"
            ],
            "White Bay / Soggy Dollar": [
                "https://images.unsplash.com/photo-1510414842594-a61c69b5ae57?w=400&h=300&fit=crop",
                "https://images.unsplash.com/photo-1540202404-a2f29016b523?w=400&h=300&fit=crop"
            ],

            // Category-based images
            beach: [
                ["https://images.unsplash.com/photo-1507525428034-b723cf961d3e?w=400&h=300&fit=crop",
                 "https://images.unsplash.com/photo-1519046904884-53103b34b206?w=400&h=300&fit=crop"],
                ["https://images.unsplash.com/photo-1590523741831-ab7e8b8f9c7f?w=400&h=300&fit=crop",
                 "https://images.unsplash.com/photo-1544551763-46a013bb70d5?w=400&h=300&fit=crop"],
                ["https://images.unsplash.com/photo-1506953823976-52e1fdc0149a?w=400&h=300&fit=crop",
                 "https://images.unsplash.com/photo-1473116763249-2faaef81ccda?w=400&h=300&fit=crop"],
                ["https://images.unsplash.com/photo-1510414842594-a61c69b5ae57?w=400&h=300&fit=crop",
                 "https://images.unsplash.com/photo-1540202404-a2f29016b523?w=400&h=300&fit=crop"],
                ["https://images.unsplash.com/photo-1559128010-7c1ad6e1b6a5?w=400&h=300&fit=crop",
                 "https://images.unsplash.com/photo-1518837695005-2083093ee35b?w=400&h=300&fit=crop"]
            ],
            restaurant: [
                ["https://images.unsplash.com/photo-1514933651103-005eec06c04b?w=400&h=300&fit=crop",
                 "https://images.unsplash.com/photo-1552566626-52f8b828add9?w=400&h=300&fit=crop"],
                ["https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?w=400&h=300&fit=crop",
                 "https://images.unsplash.com/photo-1559339352-11d035aa65de?w=400&h=300&fit=crop"],
                ["https://images.unsplash.com/photo-1544148103-0773bf10d330?w=400&h=300&fit=crop",
                 "https://images.unsplash.com/photo-1466978913421-dad2ebd01d17?w=400&h=300&fit=crop"],
                ["https://images.unsplash.com/photo-1579027989536-b7b1f875659b?w=400&h=300&fit=crop",
                 "https://images.unsplash.com/photo-1504674900247-0877df9cc836?w=400&h=300&fit=crop"]
            ],
            bar: [
                ["https://images.unsplash.com/photo-1540541338287-41700207dee6?w=400&h=300&fit=crop",
                 "https://images.unsplash.com/photo-1551024709-8f23befc6f87?w=400&h=300&fit=crop"],
                ["https://images.unsplash.com/photo-1536935338788-846bb9981813?w=400&h=300&fit=crop",
                 "https://images.unsplash.com/photo-1514362545857-3bc16c4c7d1b?w=400&h=300&fit=crop"],
                ["https://images.unsplash.com/photo-1470337458703-46ad1756a187?w=400&h=300&fit=crop",
                 "https://images.unsplash.com/photo-1546171753-97d7676e4602?w=400&h=300&fit=crop"]
            ],
            snorkel: [
                ["https://images.unsplash.com/photo-1544551763-46a013bb70d5?w=400&h=300&fit=crop",
                 "https://images.unsplash.com/photo-1582967788606-a171c1080cb0?w=400&h=300&fit=crop"],
                ["https://images.unsplash.com/photo-1559827291-72ee739d0d9a?w=400&h=300&fit=crop",
                 "https://images.unsplash.com/photo-1560275619-4662e36fa65c?w=400&h=300&fit=crop"],
                ["https://images.unsplash.com/photo-1546026423-cc4642628d2b?w=400&h=300&fit=crop",
                 "https://images.unsplash.com/photo-1571752726703-5e7d1f6a986d?w=400&h=300&fit=crop"]
            ],
            activity: [
                ["https://images.unsplash.com/photo-1544551763-92ab472cad5d?w=400&h=300&fit=crop",
                 "https://images.unsplash.com/photo-1530053969600-caed2596d242?w=400&h=300&fit=crop"],
                ["https://images.unsplash.com/photo-1504681869696-d977211a5f4c?w=400&h=300&fit=crop",
                 "https://images.unsplash.com/photo-1516939884455-1445c8652f83?w=400&h=300&fit=crop"],
                ["https://images.unsplash.com/photo-1502680390469-be75c86b636f?w=400&h=300&fit=crop",
                 "https://images.unsplash.com/photo-1530870110042-98b2cb110834?w=400&h=300&fit=crop"]
            ],
            shopping: [
                ["https://images.unsplash.com/photo-1555529669-e69e7aa0ba9a?w=400&h=300&fit=crop",
                 "https://images.unsplash.com/photo-1441986300917-64674bd600d8?w=400&h=300&fit=crop"],
                ["https://images.unsplash.com/photo-1528698827591-e19ccd7bc23d?w=400&h=300&fit=crop",
                 "https://images.unsplash.com/photo-1534452203293-494d7ddbf7e0?w=400&h=300&fit=crop"]
            ],
            favorite: [
                ["https://images.unsplash.com/photo-1514933651103-005eec06c04b?w=400&h=300&fit=crop",
                 "https://images.unsplash.com/photo-1507525428034-b723cf961d3e?w=400&h=300&fit=crop"],
                ["https://images.unsplash.com/photo-1559339352-11d035aa65de?w=400&h=300&fit=crop",
                 "https://images.unsplash.com/photo-1519046904884-53103b34b206?w=400&h=300&fit=crop"]
            ],
            home: [
                ["home-pool.jpg",
                 "home-interior.jpg"]
            ]
        };

        // Function to get images for a location
        function getImages(name, category) {
            // Check for specific location images first
            if (imageLibrary[name]) {
                return imageLibrary[name];
            }
            // Fall back to category images with deterministic selection based on name
            const categoryImages = imageLibrary[category] || imageLibrary.beach;
            const index = name.length % categoryImages.length;
            return categoryImages[index];
        }

        // All locations data with images
        const locations = [
            // HOME BASE
            { name: "Home Base", lat: 18.3185945, lng: -64.8395588, island: "St. Thomas", category: "home",
              description: "Your villa with infinity pool overlooking St. John!" },
            // ST. THOMAS - FAVORITES
            { name: "3 Palms", lat: 18.3368, lng: -64.9730, island: "St. Thomas", category: "favorite",
              description: "Personal favorite restaurant! A must-visit dining experience on St. Thomas.", url: "" },
            { name: "Tarpon's Table", lat: 18.3362, lng: -64.9735, island: "St. Thomas", category: "favorite",
              description: "Personal favorite! Excellent waterfront dining with fresh seafood.", url: "" },
            { name: "Cuv√©e", lat: 18.3420, lng: -64.9310, island: "St. Thomas", category: "favorite",
              description: "Highly recommended upscale restaurant with amazing Caribbean fusion cuisine.", url: "" },
            { name: "Bibi", lat: 18.3415, lng: -64.9305, island: "St. Thomas", category: "favorite",
              description: "Recommended dining spot with great ambiance and food.", url: "" },

            // ST. THOMAS - BEACHES
            { name: "Magens Bay", lat: 18.3720, lng: -64.9356, island: "St. Thomas", category: "beach",
              description: "Famously beautiful beach with very calm waters. Great for swimming and lounging. Bar/restaurant on one end. Bathrooms available. Visit on non-cruise ship days! Turtles can be spotted.", url: "" },
            { name: "Sapphire Beach", lat: 18.3390, lng: -64.8520, island: "St. Thomas", category: "beach",
              description: "Lively beach on the East End. Beach bar, pizza shop, snorkel rentals, and coffee shop. Nice snorkeling reef. Bathrooms available.", url: "" },
            { name: "Brewers Bay", lat: 18.3480, lng: -64.9690, island: "St. Thomas", category: "beach",
              description: "Larger beach near the University. Great snorkel spot for turtles, rays, eagle rays, and starfish. Bathrooms available. Food trucks outside.", url: "" },
            { name: "Hull Bay", lat: 18.3780, lng: -64.9480, island: "St. Thomas", category: "beach",
              description: "Popular with tourists and locals. Smaller & rockier beach with great snorkeling! 'The Shack' restaurant open day & evening.", url: "https://www.theshackhullbay.com/" },

            // ST. THOMAS - RESTAURANTS
            { name: "Fish Bar", lat: 18.3650, lng: -64.9200, island: "St. Thomas", category: "favorite",
              description: "Recommended! Located on the North Side. Locally caught fresh fish, trendy drinks, fun atmosphere. Open for dinner with nice Sunday brunch.", url: "https://www.fishbarvi.com/" },
            { name: "Oceana", lat: 18.3300, lng: -64.9420, island: "St. Thomas", category: "restaurant",
              description: "Located on the point in Frenchtown, right on the water. Nice for early evening or dinner. Reservations advised.", url: "https://www.oceanavi.com/" },
            { name: "SeaSalt", lat: 18.3390, lng: -64.8530, island: "St. Thomas", category: "restaurant",
              description: "Second floor at Sapphire Beach. Beautiful ocean views. Open for dinner. Reservations advised.", url: "https://www.seasaltvi.com/" },
            { name: "Calypso Caf√©", lat: 18.3420, lng: -64.9310, island: "St. Thomas", category: "restaurant",
              description: "Located within a jewelry store downtown. Fantastic homemade sandwiches, coffee and ice cream.", url: "" },
            { name: "Hotel 1829", lat: 18.3425, lng: -64.9305, island: "St. Thomas", category: "restaurant",
              description: "Historic Hotel with classic bar. Dinner, happy hour, Sunday brunch. Downtown and water views. Visit lobby for history lesson and authentic artifacts.", url: "https://www.hotel1829vi.com/" },
            { name: "Virgilios", lat: 18.3418, lng: -64.9312, island: "St. Thomas", category: "restaurant",
              description: "Classic Italian cuisine. Open for lunch and dinner in downtown Charlotte Amalie.", url: "" },
            { name: "Amici Caf√©", lat: 18.3422, lng: -64.9308, island: "St. Thomas", category: "restaurant",
              description: "Outdoor pizza restaurant with delicious Italian dishes in a casual setting.", url: "https://amicivi.com/" },

            // ST. THOMAS - BARS
            { name: "Taphus Beer House", lat: 18.3419, lng: -64.9315, island: "St. Thomas", category: "bar",
              description: "Open air bar with extensive craft beer options & tasty small snacks. Great for beer lovers!", url: "https://taphusbeerhousevi.com/" },
            { name: "The Shack at Hull Bay", lat: 18.3785, lng: -64.9475, island: "St. Thomas", category: "bar",
              description: "Relaxed beachside ambiance with cocktails and fish tacos. Has bingo and other fun events at night.", url: "https://www.theshackhullbay.com/" },

            // ST. THOMAS - SHOPPING
            { name: "Downtown Charlotte Amalie", lat: 18.3420, lng: -64.9310, island: "St. Thomas", category: "shopping",
              description: "Avoid on cruise ship days! Trident Jewelers for reliable jewelry. Wander waterfront, Main St, Palm Passage, Drake's Passage for art, clothing and novelty shops.", url: "" },

            // ST. THOMAS - ACTIVITIES
            { name: "Double Header Sportfishing", lat: 18.3220, lng: -64.8560, island: "St. Thomas", category: "activity",
              description: "Recommended fishing charter! Professional crew for an exciting day catching marlin, mahi, and more.", url: "" },
            { name: "Parasail VI", lat: 18.3385, lng: -64.8525, island: "St. Thomas", category: "activity",
              description: "Parasailing adventure - see the stunning islands from 400+ feet above the crystal clear waters!", url: "" },
            { name: "Wake Surfing", lat: 18.3380, lng: -64.8530, island: "St. Thomas", category: "activity",
              description: "Wake surfing experience - ride endless waves behind the boat. Great for all skill levels!", url: "" },

            // WATER ISLAND
            { name: "Honeymoon Beach (Water Island)", lat: 18.3150, lng: -64.9500, island: "Water Island", category: "beach",
              description: "Nice swimming, great snorkeling, and Dinghy's Beach Bar with live music on Sundays. 5-minute ferry from Crown Bay Marina. Golf cart rentals available to explore the island.", url: "https://waterislandferry.com/" },

            // THE WATERS - BOAT DESTINATIONS
            { name: "Lovango Cay", lat: 18.3580, lng: -64.8650, island: "The Waters", category: "restaurant",
              description: "Trendy beach resort and restaurant accessible by boat. Great vibes and Caribbean cuisine.", url: "https://www.lovangovi.com/" },
            { name: "Christmas Cove / Pizza Pi", lat: 18.3190, lng: -64.8540, island: "The Waters", category: "restaurant",
              description: "Home of Pizza Pi - the famous floating pizza boat! World's only sailboat pizzeria serving NY-style pizza in a marine sanctuary.", url: "https://pizza-pi.com/" },
            { name: "Lime Out (St. Thomas)", lat: 18.3200, lng: -64.8600, island: "The Waters", category: "favorite",
              description: "Recommended! Floating taco bar - swim up for amazing tacos and tropical drinks. Perfect boat day stop!", url: "https://limeoutvi.com/" },
            { name: "Little St. James", lat: 18.3000, lng: -64.8270, island: "The Waters", category: "snorkel",
              description: "Excellent reef snorkeling spot with vibrant coral and abundant marine life.", url: "" },

            // ST. JOHN - FAVORITES
            { name: "Extra Virgin Bistro", lat: 18.3310, lng: -64.7960, island: "St. John", category: "favorite",
              description: "Highly recommended! One of the best dinner spots in Cruz Bay with Mediterranean-Caribbean fusion. Reservations recommended.", url: "https://www.extravirginbistro.com/" },
            { name: "Zozo's", lat: 18.3470, lng: -64.7180, island: "St. John", category: "favorite",
              description: "Recommended upscale Italian restaurant with stunning sunset views over the harbor.", url: "" },
            { name: "Morgan's Mango", lat: 18.3315, lng: -64.7955, island: "St. John", category: "favorite",
              description: "Recommended Caribbean restaurant in Cruz Bay with creative island cuisine and great atmosphere.", url: "" },

            // ST. JOHN - RESTAURANTS
            { name: "La Tapa", lat: 18.3312, lng: -64.7958, island: "St. John", category: "restaurant",
              description: "Excellent Spanish tapas dinner spot in Cruz Bay. Reservations recommended.", url: "https://www.latapastjohn.com/" },
            { name: "Speakeasy", lat: 18.3308, lng: -64.7962, island: "St. John", category: "restaurant",
              description: "Great dinner spot in Cruz Bay with craft cocktails and elevated comfort food. Reservations recommended.", url: "https://www.stjspeakeasy.com/" },
            { name: "The Windmill Bar", lat: 18.3270, lng: -64.7750, island: "St. John", category: "bar",
              description: "Nice final stop before the car ferry. Food and drinks are so-so, but the panoramic view is absolutely unmatched!", url: "https://windmillbar.com/" },

            // ST. JOHN - BEACHES
            { name: "Cruz Bay Beach", lat: 18.3315, lng: -64.7965, island: "St. John", category: "beach",
              description: "Beach right at ferry dock lined with restaurants. Stroll around town for shops, bars, art galleries, and spice shops.", url: "" },
            { name: "Honeymoon Beach (STJ)", lat: 18.3530, lng: -64.7830, island: "St. John", category: "beach",
              description: "Secluded paradise requiring a 20-minute hike down. Has a beach bar. Worth the effort!", url: "" },
            { name: "Hawksnest Bay", lat: 18.3550, lng: -64.7750, island: "St. John", category: "beach",
              description: "Beautiful quiet beach on the North Shore Road with good snorkeling.", url: "" },
            { name: "Cinnamon Bay", lat: 18.3580, lng: -64.7580, island: "St. John", category: "beach",
              description: "Large beach with restaurant, bathrooms, and historic campground. Great for families.", url: "" },
            { name: "Trunk Bay", lat: 18.3530, lng: -64.7660, island: "St. John", category: "favorite",
              description: "The 'Most Famous' beach on St. John and one of the world's most beautiful! Underwater snorkel trail. Entrance fee required. Bathrooms and snacks available.", url: "" },
            { name: "Maho Bay", lat: 18.3620, lng: -64.7450, island: "St. John", category: "snorkel",
              description: "Well known for Sea Turtles! Calm waters and excellent snorkeling - often see turtles grazing on seagrass.", url: "" },
            { name: "Francis Bay", lat: 18.3650, lng: -64.7380, island: "St. John", category: "beach",
              description: "Peaceful beach on the North Shore with great bird watching and snorkeling.", url: "" },
            { name: "Waterlemon Cay", lat: 18.3680, lng: -64.7180, island: "St. John", category: "snorkel",
              description: "Premier snorkeling destination. Swim out to the cay for amazing coral and fish.", url: "" },
            { name: "Salt Pond Bay", lat: 18.3020, lng: -64.7050, island: "St. John", category: "beach",
              description: "Starting point for Ram Head hike. Beautiful secluded beach on the south shore.", url: "" },

            // ST. JOHN - HIKING
            { name: "Ram Head Trail", lat: 18.2950, lng: -64.7000, island: "St. John", category: "activity",
              description: "Recommended hike! Shorter trail with some steep sections. Starts at Salt Pond beach, ends with breathtaking Down Island views. Bring water - not much shade.", url: "" },
            { name: "Annaberg Ruins", lat: 18.3700, lng: -64.7200, island: "St. John", category: "activity",
              description: "Flat scenic trail right along the water. Explore the historic Sugar Mill ruins first, then enjoy the coastal walk.", url: "" },
            { name: "Reef Bay Trail", lat: 18.3300, lng: -64.7400, island: "St. John", category: "activity",
              description: "Hike down to the beach on the south side. See ancient petroglyphs and old Sugar Mill ruins. Swim before hiking back up.", url: "" },
            { name: "St. John Waterfall", lat: 18.3350, lng: -64.7300, island: "St. John", category: "activity",
              description: "Great rainy day alternative - visit the beautiful waterfall hidden in the tropical forest!", url: "" },

            // BVI - JOST VAN DYKE
            { name: "White Bay / Soggy Dollar", lat: 18.4320, lng: -64.7550, island: "Jost Van Dyke", category: "beach",
              description: "Stunning white sand beach home to the famous Soggy Dollar Bar - birthplace of the Painkiller cocktail! Several bars and restaurants.", url: "https://www.soggydollar.com/" },
            { name: "Sandy Cay", lat: 18.4450, lng: -64.7350, island: "Jost Van Dyke", category: "beach",
              description: "Postcard-perfect uninhabited sand island just off Jost Van Dyke. Great for photos and swimming.", url: "" },

            // BVI - TORTOLA
            { name: "Cane Garden Bay", lat: 18.4280, lng: -64.6580, island: "Tortola", category: "beach",
              description: "Tortola's most popular beach with powdery white sand, beach bars, and restaurants. Often compared to Magens Bay.", url: "" },
            { name: "Smugglers Cove", lat: 18.4380, lng: -64.7080, island: "Tortola", category: "beach",
              description: "Secluded beautiful beach on Tortola's west end. Worth the bumpy drive for its unspoiled beauty.", url: "" },

            // BVI - NORMAN ISLAND
            { name: "The Bight / Pirates Bight", lat: 18.3180, lng: -64.6180, island: "Norman Island", category: "restaurant",
              description: "Relaxing beach and restaurant at the legendary Norman Island - said to be the inspiration for Treasure Island.", url: "https://www.piratesbight.com/" },
            { name: "Willy T's", lat: 18.3170, lng: -64.6190, island: "Norman Island", category: "bar",
              description: "Legendary floating bar and restaurant! Rowdy party atmosphere where you can jump off the top deck into the water.", url: "https://willytbvi.com/" },
            { name: "The Indians", lat: 18.3280, lng: -64.6280, island: "Norman Island", category: "snorkel",
              description: "World-class snorkel spot with dramatic rock formations, colorful fish, and healthy coral.", url: "" },
            { name: "The Caves", lat: 18.3160, lng: -64.6200, island: "Norman Island", category: "snorkel",
              description: "Swim into sea caves and snorkel the reef outside. Bring an underwater flashlight!", url: "" },

            // BVI - PETER ISLAND
            { name: "Peter Island Resort", lat: 18.3550, lng: -64.5780, island: "Peter Island", category: "restaurant",
              description: "Exclusive upscale resort with pristine beaches and two fine dining restaurants. Day passes sometimes available.", url: "https://www.peterisland.com/" },

            // BVI - COOPER ISLAND
            { name: "Cooper Island Beach Club", lat: 18.3880, lng: -64.5120, island: "Cooper Island", category: "restaurant",
              description: "Eco-friendly beach resort with excellent restaurant, coffee shop, rum bar & boutique. Solar powered!", url: "https://cooperislandbeachclub.com/" },

            // BVI - VIRGIN GORDA
            { name: "The Baths", lat: 18.4320, lng: -64.4470, island: "Virgin Gorda", category: "activity",
              description: "A must-see natural wonder! Massive granite boulders create magical grottoes and pools at the ocean's edge. Scramble through the caves to Devil's Bay.", url: "" },
            { name: "Saba Rock", lat: 18.4950, lng: -64.3680, island: "Virgin Gorda", category: "restaurant",
              description: "Iconic restaurant on a tiny island in the North Sound. Tarpon feeding at sunset! Accessible by boat or ferry.", url: "https://sabarock.com/" },
            { name: "Bitter End Yacht Club", lat: 18.5050, lng: -64.3550, island: "Virgin Gorda", category: "restaurant",
              description: "Classic yacht club in the North Sound with great food and legendary sailing atmosphere.", url: "https://beyc.com/" },
            { name: "Biras Creek / Mangrove", lat: 18.5080, lng: -64.3650, island: "Virgin Gorda", category: "restaurant",
              description: "Elegant upscale dining in the North Sound surrounded by nature. Special occasion worthy.", url: "https://www.biras.com/" },
            { name: "Oil Nut Bay / Nova", lat: 18.4850, lng: -64.3280, island: "Virgin Gorda", category: "restaurant",
              description: "Ultra-luxury resort restaurant with stunning infinity pool and exceptional cuisine.", url: "https://www.oilnutbay.com/restaurant/nova/" }
        ];

        let markers = [];
        let activeCategories = ['favorite', 'beach', 'restaurant', 'activity', 'snorkel', 'bar', 'shopping'];

        // Image modal functions
        function openModal(imgSrc) {
            document.getElementById('modalImage').src = imgSrc.replace('w=400&h=300', 'w=1200&h=900');
            document.getElementById('imageModal').classList.add('active');
        }

        function closeModal() {
            document.getElementById('imageModal').classList.remove('active');
        }

        // Close modal on click outside or escape
        document.getElementById('imageModal').addEventListener('click', function(e) {
            if (e.target === this) closeModal();
        });
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') closeModal();
        });

        // Create markers
        function createMarkers() {
            markers.forEach(m => map.removeLayer(m.marker));
            markers = [];

            const categoryColors = {
                beach: '#f1c40f',
                restaurant: '#e74c3c',
                activity: '#00bcd4',
                snorkel: '#7c4dff',
                bar: '#e91e63',
                shopping: '#636e72',
                favorite: '#d63031',
                home: '#667eea'
            };

            locations.forEach(loc => {
                if (activeCategories.includes(loc.category)) {
                    const marker = L.marker([loc.lat, loc.lng], { icon: icons[loc.category] }).addTo(map);

                    const images = getImages(loc.name, loc.category);

                    let popupContent = `
                        <div class="popup-images">
                            <img src="${images[0]}" alt="${loc.name} photo 1" onclick="openModal('${images[0]}')" loading="lazy">
                            <img src="${images[1]}" alt="${loc.name} photo 2" onclick="openModal('${images[1]}')" loading="lazy">
                        </div>
                        <div class="popup-content">
                            <div class="popup-title">${loc.category === 'favorite' ? '‚≠ê ' : ''}${loc.name}</div>
                            <span class="popup-category" style="background:${categoryColors[loc.category]};color:white;">${loc.category.charAt(0).toUpperCase() + loc.category.slice(1)}</span>
                            <p class="popup-description">${loc.description}</p>
                            <p class="popup-island"><strong>üìç ${loc.island}</strong></p>
                    `;
                    if (loc.url) {
                        popupContent += `<a href="${loc.url}" target="_blank" class="popup-link">üåê Visit Website</a>`;
                    }
                    popupContent += '</div>';

                    marker.bindPopup(popupContent, { maxWidth: 350 });
                    markers.push({ marker, data: loc });
                }
            });
        }

        // Create location list
        function createLocationList() {
            const listContainer = document.getElementById('locationList');
            listContainer.innerHTML = '';

            const islands = [...new Set(locations.map(l => l.island))];

            islands.forEach(island => {
                const islandLocations = locations.filter(l =>
                    l.island === island && activeCategories.includes(l.category)
                );

                if (islandLocations.length === 0) return;

                const section = document.createElement('div');
                section.className = 'island-section';

                const header = document.createElement('div');
                header.className = 'island-header';
                header.innerHTML = `<span>üèùÔ∏è ${island}</span><span>${islandLocations.length} spots</span>`;
                section.appendChild(header);

                const locationsDiv = document.createElement('div');
                locationsDiv.className = 'island-locations';

                islandLocations.forEach(loc => {
                    const card = document.createElement('div');
                    card.className = `location-card ${loc.category}`;
                    card.innerHTML = `
                        <h4>
                            ${loc.category === 'favorite' ? '<span class="star">‚≠ê</span>' : ''}
                            ${loc.name}
                            <span class="category-tag">${loc.category}</span>
                        </h4>
                        <p>${loc.description.substring(0, 100)}${loc.description.length > 100 ? '...' : ''}</p>
                        ${loc.url ? `<a href="${loc.url}" target="_blank">Website ‚Üí</a>` : ''}
                    `;
                    card.addEventListener('click', (e) => {
                        if (e.target.tagName !== 'A') {
                            map.setView([loc.lat, loc.lng], 14);
                            const markerObj = markers.find(m => m.data.name === loc.name);
                            if (markerObj) markerObj.marker.openPopup();
                        }
                    });
                    locationsDiv.appendChild(card);
                });

                section.appendChild(locationsDiv);
                listContainer.appendChild(section);
            });
        }

        // Filter functionality
        document.querySelectorAll('.filter-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                btn.classList.toggle('active');
                const category = btn.dataset.category;

                if (btn.classList.contains('active')) {
                    if (!activeCategories.includes(category)) {
                        activeCategories.push(category);
                    }
                } else {
                    activeCategories = activeCategories.filter(c => c !== category);
                }

                createMarkers();
                createLocationList();
            });
        });

        // Add legend
        const legend = L.control({ position: 'bottomleft' });
        legend.onAdd = function() {
            const div = L.DomUtil.create('div', 'legend');
            div.innerHTML = `
                <h4>Legend</h4>
                <div class="legend-item"><div class="legend-color" style="background:#d63031;border:2px solid gold;"></div>My Favorites</div>
                <div class="legend-item"><div class="legend-color" style="background:#f1c40f;"></div>Beaches</div>
                <div class="legend-item"><div class="legend-color" style="background:#e74c3c;"></div>Restaurants</div>
                <div class="legend-item"><div class="legend-color" style="background:#00bcd4;"></div>Activities</div>
                <div class="legend-item"><div class="legend-color" style="background:#7c4dff;"></div>Snorkeling</div>
                <div class="legend-item"><div class="legend-color" style="background:#e91e63;"></div>Bars</div>
                <div class="legend-item"><div class="legend-color" style="background:#636e72;"></div>Shopping</div>
            `;
            return div;
        };
        legend.addTo(map);

        // Initialize
        createMarkers();
        createLocationList();
    </script>
</body>
</html>
